=render '/categories/breadcrumbs'

#content{itemscope:'', itemtype:"http://schema.org/Product"} 
  -if @product.variants.count>1
    %h1{itemprop:"name"}= @product.name
  .row.fly-to-cart
    -if @product.sku['expertfisher_']
      %ul#lightSlider.text-center.col-sm-12
        -@product.images.each do |img|
          %li
            =image_tag(img.image.url(:expertfisher), {itemprop:"image", title:@product.name, alt:@product.name})
    -else
      .main-img.col-sm-5
        = render 'products/images'
      .col-sm-7= render 'products/single_variant_properties', product: @product

  =render 'products/tabs'
       
  -if @product.variants.count>1
    %table.table.table-striped
      %tr
        -if @product.variants.first.image?
          %th
        -if @product.variants.first.name
          %th Имя
        -else
          %th Артикул
        -@product.variants.first.attrs.each do |attr|
          %th= attr.name
        %th Наличие
        %th Цена
        %th Купить

      -@product.variants.enabled.each do |variant|
        %tr.fly-to-cart
          = form_for @cart_item, remote: true do |f|
            = f.hidden_field :product_id
            %input(type="hidden" value="#{variant.id}" name="cart_item[variant_id]")
              -if @product.variants.first.image?
                %td
                  -if variant.image?
                    =image_tag(variant.image.url(:thumb))
              %td
                -if variant.name 
                  =variant.name
                  %br
                  %small
                    Артикул:
                    =variant.sku                   
                -else
                  =variant.sku                   
              -variant.attrs.each do |attr|
                %td= attr.value
              %td 
                =variant.availability
              %td 
                =raw variant.price_str
              %td
                -if Settings.hide_count_in_product
                  = f.hidden_field :quantity
                  %button.btn.btn-sm.btn-primary{type:'submit'}
                    %span.glyphicon.glyphicon-shopping-cart
                    Купить
                -else
                  .input-group.buy_button.input-group-sm
                    %span.input-group-btn
                      %button.btn.btn-primary{type:'submit'}
                        %span.glyphicon.glyphicon-shopping-cart
                        Купить
                    = f.text_field :quantity, class: 'form-control'
                    %span.input-group-addon 
                      шт.  

  -if @linked.present?
    #related.row
      %h2 Связанные товары
      - @linked.each do |product|
        =render "/products/show_item", product: product, category: nil, :cart_item=>@current_cart.cart_items.new(product_id: product.id, quantity:1)
