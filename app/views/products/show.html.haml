=render '/categories/breadcrumbs'

#content{itemscope:'', itemtype:"http://schema.org/Product"} 
  -if @product.variants.count>1
    %h1{itemprop:"name"}= @product.name
  .row.fly-to-cart
    -if @product.sku['expertfisher_']
      %ul#lightSlider.text-center.col-sm-12
        -@product.images.each do |img|
          %li
            =image_tag(img.image.url(:expertfisher), {itemprop:"image", title:@product.name, alt:@product.name})
    -else
      .main-img.col-sm-5
        - if @product.images.present?
          =link_to @product.images.first.image.url, class:"fancybox" do 
            =image_tag(@product.images.first.image.url(:product_page), {itemprop:"image", title:@product.name, alt:@product.name})
        -if @product.images.count >1
          .col-sm-2.col-md-2.images_thumbs
            %ul
              -@product.images[1..-1].each do |img|
                %li
                  .image_thumb
                    =link_to(image_tag(img.image.url(:thumb), itemprop:"image", title:@product.name, alt:@product.name), img.image.url, class:"fancybox")
          :javascript
            $(document).ready(function($) {
              $(".images_thumbs").jCarouselLite({
                btnNext: ".next",
                btnPrev: ".prev",
                visible: 4
              });
            });
      .col-sm-7    
        -if @product.variants.count==1
          %h1{itemprop:"name"}= @product.name
          %strong Артикул:
          =@product.variants.first.sku
          = form_for @cart_item, remote: true do |f|
            .price{itemprop:"offers", itemscope:'', itemtype:"http://schema.org/Offer"}
              = f.hidden_field :product_id
              %input(type="hidden" value="#{@product.variants.first.id}" name="cart_item[variant_id]")
              %strong Наличие
              =@product.variants.first.availability
              %br
              %strong Цена
              =raw @product.variants.first.price_str
              -if Settings.hide_count_in_product
                = f.hidden_field :quantity, value:1
                %button.btn.btn-sm.btn-primary{type:'submit'}
                  %span.glyphicon.glyphicon-shopping-cart
                  Купить
              -else
                .input-group.buy_button
                  %span.input-group-btn
                    %button.btn.btn-primary{type:'submit'}
                      %span.glyphicon.glyphicon-shopping-cart
                      Купить
                  = f.text_field :quantity, class: 'form-control'
                  %span.input-group-addon 
                    шт.  

  %div{role: :tabpanel}
    %ul.nav.nav-tabs{role: :tablist}
      %li.active{role: :presentation}
        %a.strong{:'aria-controls'=>:description, role: :tab, :'data-toggle'=>:tab, href: '#description'} Описание
      -if @product.attrs.count>0
        %li{role: :presentation}
          %a.strong{:'aria-controls'=>:attrs, role: :tab, :'data-toggle'=>:tab, href: '#attrs'} Характеристики
    .tab-content
      .tab-pane.active#description{role: :tabpanel}
        .description{itemprop:"description"}= raw @product.description
      .tab-pane#attrs{role: :tabpanel}
        -if @product.attrs.count>0
          %table.table.table-condensed.attributes
            -@product.attrs.all.each do |attr|
              %tr
                %td
                  =attr.name
                %td
                  =attr.value
            -# -if @product.attrs.count > 5 
            -#   %tr
            -#     %td{colspan:2}
            -#       %a.show-all{href:'#'}
            -#         Показать все

       
  -if @product.variants.count>1
    %table.table.table-striped
      %tr
        -if @product.variants.first.image?
          %th
        -if @product.variants.first.name
          %th Имя
        -else
          %th Артикул
        -@product.variants.first.attrs.each do |attr|
          %th= attr.name
        %th Наличие
        %th Цена
        %th Купить

      -@product.variants.enabled.each do |variant|
        %tr.fly-to-cart
          = form_for @cart_item, remote: true do |f|
            = f.hidden_field :product_id
            %input(type="hidden" value="#{variant.id}" name="cart_item[variant_id]")
              -if @product.variants.first.image?
                %td
                  -if variant.image?
                    =image_tag(variant.image.url(:thumb))
              %td
                -if variant.name 
                  =variant.name
                  %br
                  %small
                    Артикул:
                    =variant.sku                   
                -else
                  =variant.sku                   
              -variant.attrs.each do |attr|
                %td= attr.value
              %td 
                =variant.availability
              %td 
                =raw variant.price_str
              %td
                -if Settings.hide_count_in_product
                  = f.hidden_field :quantity
                  %button.btn.btn-sm.btn-primary{type:'submit'}
                    %span.glyphicon.glyphicon-shopping-cart
                    Купить
                -else
                  .input-group.buy_button.input-group-sm
                    %span.input-group-btn
                      %button.btn.btn-primary{type:'submit'}
                        %span.glyphicon.glyphicon-shopping-cart
                        Купить
                    = f.text_field :quantity, class: 'form-control'
                    %span.input-group-addon 
                      шт.  

  -if @linked.present?
    #related.row
      %h2 Связанные товары
      - @linked.each do |product|
        =render "/products/show_item", product: product, category: nil, :cart_item=>@current_cart.cart_items.new(product_id: product.id, quantity:1)
